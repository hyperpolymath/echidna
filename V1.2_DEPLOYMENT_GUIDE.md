# ECHIDNA v1.2 Deployment Guide

**Version**: 1.2.0
**Date**: 2026-01-28
**Status**: Production-Ready

---

## Quick Start

### Prerequisites

- **Rust** 1.75+
- **Julia** 1.10+
- **Deno** 1.40+
- **Podman** (NOT Docker)
- **Just** command runner
- 4GB RAM minimum, 8GB recommended
- Optional: CUDA-capable GPU for neural training

### Install Dependencies

```bash
# Clone repository
git clone https://github.com/hyperpolymath/echidna.git
cd echidna

# Install system tools
curl -sf https://just.systems/install.sh | bash  # Just
curl -fsSL https://deno.land/install.sh | sh     # Deno

# Install Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Install Julia
curl -fsSL https://install.julialang.org | sh
```

### Build & Run

```bash
# Build everything
just build-all

# Run tests
just test

# Start development server
just dev
```

The application will be available at:
- **UI**: http://localhost:3000
- **API**: http://localhost:8080
- **Julia ML**: http://localhost:8000

---

## Architecture

### Component Stack

```
┌────────────────────────────────────────┐
│         User Interface (Port 3000)      │
│         ReScript + Deno + Tailwind      │
└─────────────┬──────────────────────────┘
              │ HTTP + WebSocket
┌─────────────▼──────────────────────────┐
│         Rust Backend (Port 8080)        │
│         ├─ REST API                     │
│         ├─ WebSocket server             │
│         └─ 12 Prover backends           │
└─────────────┬──────────────────────────┘
              │ HTTP
┌─────────────▼──────────────────────────┐
│    Julia ML Service (Port 8000)        │
│    ├─ Neural premise selection         │
│    ├─ Tactic suggestion                │
│    └─ Model serving                    │
└────────────────────────────────────────┘
```

---

## Deployment Options

### Option 1: Local Development (Easiest)

**Use Case**: Local development, testing

```bash
# Terminal 1: Julia ML server
just julia-server

# Terminal 2: Rust backend
just rust-server

# Terminal 3: ReScript dev server
just rescript-dev

# Open browser
open http://localhost:3000
```

**Pros**:
- Fast iteration
- Hot reload
- Easy debugging

**Cons**:
- Requires 3 terminals
- Not production-ready

---

### Option 2: Podman Container (Recommended)

**Use Case**: Production deployment, CI/CD

```bash
# Build container
podman build -f Containerfile -t echidna:1.2.0 .

# Run container
podman run -d \
  --name echidna \
  -p 8080:8080 \
  -p 8000:8000 \
  -p 3000:3000 \
  echidna:1.2.0

# Check logs
podman logs -f echidna

# Stop
podman stop echidna
```

**Container includes**:
- All 12 prover binaries (where available)
- Pre-built Rust binary
- Julia with pre-compiled packages
- ReScript static build

**Pros**:
- Single command deployment
- Reproducible builds
- Portable

**Cons**:
- Large image size (~2GB)
- Longer build time

---

### Option 3: Kubernetes (Production Scale)

**Use Case**: High availability, horizontal scaling

**Create deployment**:

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echidna
spec:
  replicas: 3
  selector:
    matchLabels:
      app: echidna
  template:
    metadata:
      labels:
        app: echidna
    spec:
      containers:
      - name: echidna
        image: ghcr.io/hyperpolymath/echidna:1.2.0
        ports:
        - containerPort: 8080  # Rust API
        - containerPort: 8000  # Julia ML
        - containerPort: 3000  # UI
        resources:
          requests:
            memory: "2Gi"
            cpu: "1000m"
          limits:
            memory: "4Gi"
            cpu: "2000m"
        env:
        - name: RUST_LOG
          value: "info"
        - name: JULIA_NUM_THREADS
          value: "4"
---
apiVersion: v1
kind: Service
metadata:
  name: echidna-service
spec:
  selector:
    app: echidna
  ports:
  - name: api
    port: 8080
    targetPort: 8080
  - name: ml
    port: 8000
    targetPort: 8000
  - name: ui
    port: 3000
    targetPort: 3000
  type: LoadBalancer
```

**Deploy**:

```bash
kubectl apply -f k8s/deployment.yaml
kubectl get pods
kubectl logs -f deployment/echidna
```

**Pros**:
- Auto-scaling
- Load balancing
- Self-healing
- Production-grade

**Cons**:
- Requires Kubernetes cluster
- More complex setup

---

## Configuration

### Environment Variables

```bash
# Rust Backend
export RUST_LOG=info              # Logging level
export ECHIDNA_PORT=8080          # API port
export ECHIDNA_HOST=0.0.0.0       # Bind address
export JULIA_ML_URL=http://localhost:8000  # Julia ML endpoint

# Julia ML Service
export JULIA_NUM_THREADS=4        # Parallelism
export JULIA_ML_PORT=8000         # ML API port
export CUDA_VISIBLE_DEVICES=0     # GPU selection

# ReScript UI
export API_URL=http://localhost:8080  # Backend API
export WS_URL=ws://localhost:8080/ws  # WebSocket
```

### Prover Binaries

Configure paths to prover executables:

```bash
# Create config file
cat > ~/.echidna.toml <<EOF
[provers.acl2]
executable = "/usr/local/bin/acl2"
timeout = 300

[provers.pvs]
executable = "/opt/pvs/pvs"
library_paths = ["/opt/pvs/lib"]
timeout = 600

[provers.hol4]
executable = "/usr/local/bin/hol"
timeout = 300

# ... other provers
EOF
```

Or use environment variables:

```bash
export ECHIDNA_ACL2_PATH=/usr/local/bin/acl2
export ECHIDNA_PVS_PATH=/opt/pvs/pvs
export ECHIDNA_HOL4_PATH=/usr/local/bin/hol
```

---

## Integration Testing

### Run Full Test Suite

```bash
# Unit tests
cargo test --lib

# Integration tests (requires prover binaries)
cargo test --test integration_v1_2

# Property tests
cargo test --test property_tests

# Benchmarks
cargo bench

# Coverage
just coverage
```

### Test Individual Components

```bash
# Test ACL2 backend only
cargo test --lib acl2

# Test PVS backend only
cargo test --lib pvs

# Test HOL4 backend only
cargo test --lib hol4

# Test all 12 provers
cargo test --test integration_v1_2 test_all_provers_available
```

---

## Neural Model Training

### Generate Training Data

```bash
# Extract proofs from examples
just generate-training-data

# This creates:
# - training_data/proofs.jsonl (proof states)
# - training_data/tactics.jsonl (tactic applications)
# - training_data/premises.jsonl (premise usages)
```

### Train Models

```bash
# Start Julia REPL
julia --project=src/julia

# In Julia:
using EchidnaML

# Load training data
data = load_training_data("training_data/")

# Train premise selector
premise_model = train_premise_selector(data)

# Train tactic predictor
tactic_model = train_tactic_predictor(data)

# Save models
save_model(premise_model, "models/premise_selector.bson")
save_model(tactic_model, "models/tactic_predictor.bson")
```

### Serve Trained Models

```bash
# Start ML server with trained models
PREMISE_MODEL=models/premise_selector.bson \
TACTIC_MODEL=models/tactic_predictor.bson \
julia --project=src/julia src/julia/api/server.jl
```

---

## Monitoring

### Health Checks

```bash
# Check Rust API
curl http://localhost:8080/health

# Check Julia ML
curl http://localhost:8000/health

# Check UI
curl http://localhost:3000/
```

### Metrics

```bash
# Prometheus metrics endpoint
curl http://localhost:8080/metrics

# Example metrics:
# - echidna_proofs_total{prover="acl2"}
# - echidna_proof_time_seconds{prover="pvs"}
# - echidna_neural_suggestions_total
```

### Logging

```bash
# View logs
journalctl -u echidna -f  # systemd
podman logs -f echidna    # container
kubectl logs -f deployment/echidna  # k8s

# Log levels: trace, debug, info, warn, error
export RUST_LOG=echidna=debug
```

---

## Security

### API Authentication

Enable API keys:

```bash
# Generate API key
openssl rand -hex 32

# Configure
export ECHIDNA_API_KEY=your-key-here

# Use in requests
curl -H "Authorization: Bearer your-key-here" \
  http://localhost:8080/api/prove
```

### TLS/HTTPS

```bash
# Generate self-signed cert (development)
openssl req -x509 -newkey rsa:4096 \
  -keyout key.pem -out cert.pem -days 365 -nodes

# Configure Rust server
export ECHIDNA_TLS_CERT=cert.pem
export ECHIDNA_TLS_KEY=key.pem
```

Production: Use Let's Encrypt or cloud provider certs.

---

## Performance Tuning

### Rust Backend

```bash
# Build with optimizations
cargo build --release

# Profile-guided optimization
cargo pgo build

# Reduce binary size
strip target/release/echidna
```

### Julia ML

```bash
# Precompile packages
julia --project=src/julia -e 'using Pkg; Pkg.precompile()'

# Enable GPU
export JULIA_CUDA_USE_BINARYBUILDER=false

# Thread parallelism
export JULIA_NUM_THREADS=$(nproc)
```

### Database (if using)

```bash
# Use connection pooling
export DATABASE_POOL_SIZE=10

# Enable query caching
export CACHE_ENABLED=true
export CACHE_TTL=3600
```

---

## Troubleshooting

### Issue: Prover binary not found

```bash
# Check prover installation
which acl2  # Should show path
which pvs
which hol

# Add to PATH
export PATH=$PATH:/opt/pvs:/usr/local/acl2
```

### Issue: Julia package errors

```bash
# Reset Julia environment
rm -rf src/julia/Manifest.toml
julia --project=src/julia -e 'using Pkg; Pkg.instantiate()'
```

### Issue: ReScript build fails

```bash
# Clean and rebuild
rm -rf src/rescript/lib
npm run clean
npm run build
```

### Issue: Port already in use

```bash
# Find process using port
lsof -i :8080
kill -9 <PID>

# Or use different port
export ECHIDNA_PORT=8081
```

---

## Backup & Recovery

### Backup Trained Models

```bash
# Backup models
tar -czf models-backup-$(date +%Y%m%d).tar.gz models/

# Upload to S3 (example)
aws s3 cp models-backup-*.tar.gz s3://my-bucket/echidna/
```

### Backup Configuration

```bash
# Backup config
cp ~/.echidna.toml echidna-config-backup.toml
```

---

## Scaling

### Horizontal Scaling

```bash
# Run multiple API instances behind load balancer
for i in {1..4}; do
  ECHIDNA_PORT=$((8080 + i)) \
  cargo run --release &
done

# Configure nginx load balancer
upstream echidna {
  server localhost:8081;
  server localhost:8082;
  server localhost:8083;
  server localhost:8084;
}
```

### Vertical Scaling

```bash
# Increase memory limit
export JULIA_MEMORY_POOL_SIZE=4GB

# Increase thread pool
export TOKIO_WORKER_THREADS=16
```

---

## Support

- **Documentation**: https://echidna.readthedocs.io
- **Issues**: https://github.com/hyperpolymath/echidna/issues
- **Discussions**: https://github.com/hyperpolymath/echidna/discussions
- **Security**: security@echidna-project.org

---

## License

Dual-licensed: MIT OR Palimpsest-0.6
